# 📊 RAG 청크 크기 실험 결과 분석

## 🔬 실험 설정

| 항목 | 값 |
|------|-----|
| **문서** | 2040_seoul_plan.pdf |
| **테스트 질문 수** | 3개 |
| **청크 크기 조합** | 3가지 |
| **측정 값** | Top 3 유사도 점수 |

---

## 📈 실험 결과

### 질문 1: "서울의 지역내 총생산이 증가했어?"

| 청크 크기 설정 | 1위 점수 | 2위 점수 | 3위 점수 | 평균 |
|----------------|----------|----------|----------|------|
| **200 / 100** | 0.560 | 0.554 | 0.540 | **0.551** ✅ |
| **300 / 150** | 0.541 | 0.495 | 0.489 | 0.508 |
| **800 / 350** | 0.530 | 0.510 | 0.479 | 0.506 |

**결과**: 작은 청크(200/100)가 가장 높은 유사도

---

### 질문 2: "서울시의 수변 공간 활성화 전략이 따로 있어?"

| 청크 크기 설정 | 1위 점수 | 2위 점수 | 3위 점수 | 평균 |
|----------------|----------|----------|----------|------|
| **200 / 100** | 0.679 | 0.660 | 0.632 | **0.657** ✅ |
| **300 / 150** | 0.655 | 0.639 | 0.634 | 0.643 |
| **800 / 350** | 0.628 | 0.607 | 0.530 | 0.588 |

**결과**: 작은 청크(200/100)가 가장 높은 유사도

---

### 질문 3: "기반 시설 입체화를 위해서 서울시에서 추진하는 전략이 있어?"

| 청크 크기 설정 | 1위 점수 | 2위 점수 | 3위 점수 | 평균 |
|----------------|----------|----------|----------|------|
| **800 / 350** | 0.653 | 0.635 | 0.576 | **0.621** ✅ |
| **200 / 100** | 0.632 | 0.630 | 0.619 | 0.627 |
| **300 / 150** | 0.626 | 0.619 | 0.606 | 0.617 |

**결과**: 큰 청크(800/350)가 가장 높은 1위 점수

---

## 🎯 종합 분석

### 📊 설정별 성능 요약

| 순위 | 청크 크기 | 특징 | 적합한 질문 유형 |
|------|-----------|------|------------------|
| 🥇 1위 | **200 / 100** | • 평균 유사도 가장 높음<br>• 질문 1, 2에서 우수<br>• 구체적 키워드 매칭에 강함 | **단순 사실 확인**<br>"~이 있어?", "~증가했어?" |
| 🥈 2위 | **300 / 150** | • 안정적인 중간 성능<br>• 편차가 적음<br>• 무난한 선택 | **일반적인 질문**<br>균형잡힌 답변 필요 시 |
| 🥉 3위 | **800 / 350** | • 복잡한 질문에서 가끔 우수<br>• 평균적으로 낮은 성능<br>• 편차 큼 | **복잡한 맥락 이해**<br>"전략", "계획" 등 |

---

## 💡 핵심 인사이트

### ✅ **작은 청크(200/100)가 더 좋은 이유**

1. **정확한 키워드 매칭**
   - "수변 공간", "지역내 총생산" 같은 구체적 용어 포착

2. **노이즈 최소화**
   - 관련 없는 내용이 청크에 포함될 가능성 ↓

3. **임베딩 벡터 집중도**
   - 작은 텍스트 = 명확한 주제 = 높은 유사도

### ❌ **큰 청크(800/350)가 낮은 이유**

1. **정보 희석**
   - 너무 많은 내용 = 핵심 키워드 비중 ↓

2. **맥락 과다**
   - 관련 없는 문장이 함께 포함되어 유사도 저하

3. **임베딩 벡터 분산**
   - 여러 주제 혼재 = 벡터 유사도 계산 시 불리

---

## 🎓 질문 유형별 권장 설정

### 1️⃣ **단순 사실 확인형**

```
질문 예시: "~이 있어?", "~증가했어?", "~는 무엇?"
권장 설정: 200 / 100 ⭐
이유: 구체적 키워드 매칭에 유리
```

### 2️⃣ **복합 개념 이해형**

```
질문 예시: "~의 전략은?", "~와 ~의 관계는?"
권장 설정: 300 / 150 ⭐
이유: 맥락과 정확도의 균형
```

### 3️⃣ **넓은 맥락 파악형**

```
질문 예시: "전체적인 계획은?", "종합적으로 설명해줘"
권장 설정: 400 / 200 ⭐
이유: 충분한 맥락 정보 필요
```

---

## 🏆 최종 추천

### **일반적인 경우**

```yaml
임시 청크 크기: 200
최소 청크 크기: 100
유사도 임계값: 0.60
```

**장점:**
- 가장 안정적인 높은 유사도
- 정확한 정보 검색
- 빠른 처리 속도

**단점:**
- 맥락이 부족할 수 있음

### **맥락이 중요한 경우**

```yaml
임시 청크 크기: 300
최소 청크 크기: 150
유사도 임계값: 0.55
```

**장점:**
- 적절한 맥락 제공
- 안정적인 성능
- 편차 적음

**단점:**
- 최고 유사도는 아님

---

## 📌 실무 적용 가이드

### ⚙️ 설정 선택 플로우차트

```
질문이 단순한가?
├─ YES → 200/100 (정확도 우선)
└─ NO
    └─ 넓은 맥락이 필요한가?
        ├─ YES → 400/200 (맥락 우선)
        └─ NO → 300/150 (균형)
```

### 🔧 튜닝 팁

**1. 유사도가 너무 낮다면 (<0.5)**
- 청크 크기를 **작게** 조정 (200 → 150)
- 질문을 더 구체적으로 변경

**2. 답변이 맥락이 부족하다면**
- 청크 크기를 **크게** 조정 (200 → 300)
- Top-K 개수 증가 (3 → 5)

**3. 관련 없는 답변이 나온다면**
- 유사도 임계값 **상향** (0.6 → 0.65)
- 메타데이터 필터 활용 (출처 지정)

---

## 📝 결론

> **이 문서에서는 작은 청크(200/100)가 대부분의 질문에서 가장 높은 유사도를 보였습니다.**  
> 단, 질문 유형과 요구사항에 따라 적절한 조정이 필요합니다.

### 베스트 프랙티스

- 🎯 **기본값으로 200/100 사용**
- 🔄 성능 모니터링 후 필요시 조정
- 📊 질문 유형별로 다른 설정 프리셋 준비

---

## 📋 원본 실험 데이터

### 질문 1: 서울의 지역내 총생산이 증가했어?

**200 / 100:**
```
score=0.5599997341632843
score=0.55367311835289
score=0.539603978395462
```

**800 / 350:**
```
score=0.5300518572
score=0.5101951658725739
score=0.4794641137123108
```

**300 / 150:**
```
score=0.5409706234931946
score=0.4951431155204773
score=0.48894762992858887
```

### 질문 2: 서울시의 수변 공간 활성화 전략이 따로 있어?

**200 / 100:**
```
score=0.6785665154457092
score=0.6599193513393402
score=0.6321031451225281
```

**800 / 350:**
```
score=0.628476470708847
score=0.6071394383907318
score=0.5300518572330475
```

**300 / 150:**
```
score=0.6553750932216644
score=0.6388700008392334
score=0.6341999471187592
```

### 질문 3: 기반 시설 입체화를 위해서 서울시에서 추진하는 전략이 있어?

**200 / 100:**
```
score=0.6319521963596344
score=0.6303811371326447
score=0.6193589270114899
```

**800 / 350:**
```
score=0.6534741818904877
score=0.6353539526462555
score=0.5758554637432098
```

**300 / 150:**
```
score=0.6257141828536987
score=0.6185974478721619
score=0.6061351299285889
```

---

**작성일**: 2025-10-30  
**문서 버전**: 1.0